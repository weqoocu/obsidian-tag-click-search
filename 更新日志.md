# Tag Click Search - 更新日志

## 版本 1.0.3 (2025-11-29)

### ✨ 界面优化

#### 简化搜索结果显示
**改进：** 搜索结果面板现在只显示笔记的 title 属性，移除了文件名显示。

**变化对比：**
```
修改前：
我的笔记标题 (note-file-name)

修改后：
我的笔记标题
```

**优点：**
- ✅ 界面更简洁清爽
- ✅ 减少视觉干扰
- ✅ 悬停时仍可查看完整路径

---

## 版本 1.0.2 (2025-11-29)

### 🐛 Bug 修复 - 标签识别错误

#### 问题描述
当两个标签紧挨在一起时（如 `#凡人修仙传  #仙逆`），点击第一个标签会错误地识别为 `#凡人修仙传#仙逆`，而不是单独的 `#凡人修仙传`。

#### 根本原因
`extractFullTag` 方法在收集标签片段时，会持续收集所有相邻的 `.cm-hashtag` 元素，没有正确判断标签的结束位置。

#### 修复内容

1. **添加标签结束判断**
   ```javascript
   // 修复前：持续收集所有 cm-hashtag 元素
   while (current && current.classList.contains('cm-hashtag')) {
       tagText += current.textContent;
       current = current.nextElementSibling;
   }
   
   // 修复后：正确判断标签结束
   while (current && current.classList.contains('cm-hashtag')) {
       tagText += current.textContent;
       
       // 遇到结束标记，停止收集
       if (current.classList.contains('cm-hashtag-end')) {
           break;
       }
       
       current = current.nextElementSibling;
       
       // 遇到新标签开始，停止收集
       if (current && current.classList.contains('cm-hashtag-begin')) {
           break;
       }
   }
   ```

2. **添加详细的调试日志**
   - 显示每个收集的片段和类名
   - 显示停止收集的原因
   - 显示最终提取的标签名

### ✅ 测试场景

| 场景 | 修复前 | 修复后 |
|-----|--------|--------|
| `#凡人修仙传  #仙逆` | 识别为 `凡人修仙传#仙逆` ❌ | 正确识别为 `凡人修仙传` ✅ |
| `#测试1 #测试2 #测试3` | 识别为 `测试1#测试2#测试3` ❌ | 正确识别为 `测试1` ✅ |

---

## 版本 1.0.1 (2025-11-29)

### 🐛 Bug 修复

#### 问题描述
插件在点击标签时出现错误：
```
Uncaught (in promise) TypeError: Cannot read properties of null (reading 'toString')
at eval (plugin:tag-click-search:269:27)
```

#### 根本原因
在处理 frontmatter 中的标签数组时，某些标签值可能为 `null` 或 `undefined`，代码直接调用 `.toString()` 方法导致错误。

#### 修复内容

1. **添加 null 检查**
   ```javascript
   // 修复前
   cache.frontmatter.tags.some(t => 
       t.toString().toLowerCase() === cleanTag
   )
   
   // 修复后
   cache.frontmatter.tags.some(t => 
       t != null && t.toString().toLowerCase() === cleanTag
   )
   ```

2. **添加标签名称验证**
   - 检查清理后的标签名称是否为空
   - 避免搜索空标签

3. **添加错误处理**
   - 在 `searchAndDisplayTag` 方法外层添加 try-catch
   - 捕获所有可能的错误并显示友好的提示
   - 在控制台输出详细的错误信息

### ✅ 测试建议

请按以下步骤验证修复：

1. **重新加载插件**
   ```
   设置 → 社区插件 → Tag Click Search
   关闭 → 等待1秒 → 开启
   ```

2. **测试正常标签**
   - 打开包含标签的笔记（如 `#测试`）
   - 点击标签
   - 应该正常打开搜索结果

3. **测试边界情况**
   - 包含 null 值的 frontmatter 标签
   - 空标签
   - 特殊字符标签

### 📝 技术改进

- ✅ 更严格的 null 检查（使用 `!= null` 而不是 `!`）
- ✅ 更完善的错误处理机制
- ✅ 更详细的调试日志
- ✅ 用户友好的错误提示

### 🔍 如何查看日志

1. 打开开发者控制台：`Cmd+Option+I` (Mac) 或 `Ctrl+Shift+I` (Windows)
2. 点击标签
3. 观察日志输出：
   ```
   Searching for tag: #标签名
   Found X files with tag #标签名
   ```

如果仍有问题，请复制控制台的完整错误信息。

---

## 版本 1.0.0 (首次发布)

### ✨ 主要功能

- 点击编辑器中的标签自动搜索
- 在右侧边栏显示搜索结果
- 按 title 属性排序（支持中文）
- 支持阅读模式和编辑模式
- 提供命令面板搜索功能
