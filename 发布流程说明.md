# 🎉 完善的发布流程已就绪！

## ✨ 新增功能

### 1. 🔍 安全检查 (`pre-release-check.sh`)

**自动检查以下内容：**

#### ✅ 版本号一致性
- 检查 `manifest.json`、`package.json`、`versions.json` 中的版本号是否一致
- 确保 versions.json 包含新版本

#### 🔒 敏感信息扫描
自动扫描代码中的敏感关键词：
- 密码相关：`password`, `passwd`, `secret`
- 密钥相关：`api_key`, `apikey`, `token`, `access_key`, `private_key`
- 凭证相关：`credential`
- 公司相关：`腾讯`, `tencent`, `weixin`, `微信`, `内部`

#### 🗑️ 不相关文件检查
检测不应提交的文件：
- 环境变量文件：`.env*`
- 临时文件：`*.log`, `*.tmp`, `*.swp`
- 系统文件：`.DS_Store`, `Thumbs.db`
- Release 临时目录：`release-*`

#### 📝 版本更新检查
- 确认最近的提交是否更新了版本文件
- 提醒是否忘记更新版本号

#### 📦 必需文件检查
- 确保 `main.js`, `manifest.json`, `README.md`, `LICENSE` 都存在

---

### 2. 🧹 自动清理 (`cleanup.sh`)

**一键清理不相关文件：**
- 删除 `release-*` 临时目录
- 删除临时 release notes (`RELEASE_NOTES_v*.md`)
- 删除 `.DS_Store` 系统文件
- 删除 `*.log` 日志文件
- 删除 `*.tmp`, `*.swp` 临时文件

---

### 3. 🚀 一键发布 (`publish.sh`)

**完整的发布工作流：**

```
步骤 1: 清理不相关文件
    ↓
步骤 2: 预发布安全检查
    ↓
步骤 3: 提交代码到 GitHub
    ↓
步骤 4: 自动创建 Release
```

---

### 4. 🔒 增强的 .gitignore

新增保护：
```gitignore
# 敏感文件
.env
.env.*
*secret*
*password*
*credential*

# Release 临时文件
release-*/
RELEASE_NOTES_v*.md
```

---

## 🎯 使用方法

### 方式一：一键发布（最简单）⭐

```bash
# 1. 更新版本号（手动编辑3个文件）
vim manifest.json package.json versions.json

# 2. 运行一键发布
bash publish.sh
```

就这么简单！脚本会自动引导你完成所有步骤。

---

### 方式二：分步执行

```bash
# 1. 清理不相关文件
bash cleanup.sh

# 2. 预发布检查
bash pre-release-check.sh

# 3. 手动提交代码
git add .
git commit -m "v1.4.3: 新功能"
git push origin main

# 4. 自动发布 Release
bash release-auto.sh
```

---

## 📋 完整发布流程示例

```bash
# === 开发阶段 ===
# 编写代码，测试功能
vim main.js

# === 准备发布 ===
# 1. 更新版本号（3个文件）
vim manifest.json    # "version": "1.4.3"
vim package.json     # "version": "1.4.3"
vim versions.json    # "1.4.3": "0.15.0"

# 2. 更新 CHANGELOG.md（可选但推荐）
vim CHANGELOG.md

# === 一键发布 ===
bash publish.sh

# 脚本会自动完成：
# ✅ 清理临时文件
# ✅ 检查版本号
# ✅ 扫描敏感信息
# ✅ 检查不相关文件
# ✅ 提交代码到 GitHub
# ✅ 创建 Git tag
# ✅ 触发 GitHub Actions
# ✅ 自动创建 Release

# === 完成 ===
# 1-2 分钟后，Release 自动创建完成！
# 🎉 发布成功！
```

---

## 🛡️ 安全保障

### 防止敏感信息泄露
- ✅ 自动扫描密码、密钥、token
- ✅ 检测公司内部关键词
- ✅ .gitignore 防护敏感文件

### 防止不相关文件提交
- ✅ 自动清理临时文件
- ✅ 过滤系统文件
- ✅ 排除 release 临时目录

### 确保发布质量
- ✅ 版本号一致性验证
- ✅ 必需文件完整性检查
- ✅ Git 状态检查

---

## 📊 检查示例输出

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 预发布检查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1/6] 检查版本号一致性...
✅ 版本号一致: v1.4.3
✅ versions.json 已包含当前版本

[2/6] 检查 Git 状态...
✅ 没有未提交的更改

[3/6] 检查最近提交是否更新版本号...
✅ 最近提交已更新版本文件

[4/6] 扫描敏感信息...
✅ 未发现明显的敏感信息

[5/6] 检查不相关文件...
✅ 未发现不相关文件

[6/6] 检查必需文件...
✅ 所有必需文件都存在

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 检查通过！可以安全发布
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 📚 可用脚本

| 脚本 | 功能 | 使用场景 |
|------|------|----------|
| `publish.sh` ⭐ | 完整发布流程 | 发布新版本（推荐） |
| `pre-release-check.sh` | 安全检查 | 发布前检查 |
| `cleanup.sh` | 清理文件 | 清理临时文件 |
| `release-auto.sh` | 自动 Release | 仅创建 Release |
| `release-manual.sh` | 手动 Release | 无 GitHub CLI 时 |
| `release.sh` | GitHub CLI Release | 需要 gh CLI |

---

## 🎯 推荐工作流

**日常开发** → 修改代码，提交到 GitHub

**准备发布** → 更新版本号（3个文件）

**发布新版本** → 运行 `bash publish.sh`

**等待完成** → 1-2 分钟后 Release 自动创建 🎉

---

## ❓ 常见问题

### Q: 检查发现敏感信息怎么办？
A: 检查报告的文件和行号，确认是否真的是敏感信息：
- 如果是：立即删除或移到配置文件
- 如果是误报：可以忽略（如注释中的说明文字）

### Q: 版本号不一致怎么办？
A: 手动检查并修改这3个文件，确保版本号完全一致：
- `manifest.json`
- `package.json`
- `versions.json`

### Q: 可以跳过检查直接发布吗？
A: 不建议。安全检查是为了保护你的代码和隐私。

---

## 🔗 相关文档

- [发布指南](./PUBLISH_GUIDE.md) - 详细的发布说明
- [自动 Release](./RELEASE_AUTO.md) - GitHub Actions 说明
- [如何发布](./HOW_TO_RELEASE.md) - 三种发布方式对比

---

**🎉 现在你拥有了完善的发布流程！**

安全、高效、自动化 ✨
